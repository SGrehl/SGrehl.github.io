<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-07-02">

<title>Experimental Sociology - Week 13 – ES &amp; CSS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2fa0555fe88427c29efa1b60aaf9e62d.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-024b15207476f2674d9c8aca10390aa5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #5791b5;
      }
</style>
<link href="../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="../site_libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="../site_libs/typedarray-0.1/typedarray.min.js"></script>

<script src="../site_libs/jquery-3.5.1/jquery.min.js"></script>

<link href="../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="../site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>

<script type="text/javascript" src="../js/week-control.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ES &amp; CSS</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-general-information" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">General Information</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-general-information">    
        <li>
    <a class="dropdown-item" href="../general-information/exam.html">
 <span class="dropdown-text">Course Assessment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../general-information/sc.html">
 <span class="dropdown-text">Scientific Computing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../general-information/data.html">
 <span class="dropdown-text">Data Sources</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../general-information/ai_usage.html">
 <span class="dropdown-text">AI-Usage</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../general-information/anti_dis.html">
 <span class="dropdown-text">Anti-Discrimination Policy</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-experimental-sociology" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Experimental Sociology</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-experimental-sociology">    
        <li>
    <a class="dropdown-item" href="../experimental-sociology/es_overview.html">
 <span class="dropdown-text">Course Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../experimental-sociology/week01.html">
 <span class="dropdown-text">Week 01</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../experimental-sociology/week02.html">
 <span class="dropdown-text">Week 02</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../experimental-sociology/week03.html">
 <span class="dropdown-text">Week 03</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../experimental-sociology/week04.html">
 <span class="dropdown-text">Week 04</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../experimental-sociology/week05.html">
 <span class="dropdown-text">Week 05</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../experimental-sociology/week06.html">
 <span class="dropdown-text">Week 06</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../experimental-sociology/week07.html">
 <span class="dropdown-text">Week 07</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../experimental-sociology/week08.html">
 <span class="dropdown-text">Week 08</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../experimental-sociology/week09.html">
 <span class="dropdown-text">Week 09</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../experimental-sociology/week10.html">
 <span class="dropdown-text">Week 10</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../experimental-sociology/week11.html">
 <span class="dropdown-text">Week 11</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../experimental-sociology/week12.html">
 <span class="dropdown-text">Week 12</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../experimental-sociology/week13.html">
 <span class="dropdown-text">Week 13</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../experimental-sociology/week14.html">
 <span class="dropdown-text">Week 14</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-computational-social-sciences" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Computational Social Sciences</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-computational-social-sciences">    
        <li>
    <a class="dropdown-item" href="../computational-social-sciences/css_overview.html">
 <span class="dropdown-text">Course Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../computational-social-sciences/week01.html">
 <span class="dropdown-text">Week 01</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../computational-social-sciences/week02.html">
 <span class="dropdown-text">Week 02</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../computational-social-sciences/week03.html">
 <span class="dropdown-text">Week 03</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../computational-social-sciences/week04.html">
 <span class="dropdown-text">Week 04</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../computational-social-sciences/week05.html">
 <span class="dropdown-text">Week 05</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../computational-social-sciences/week06.html">
 <span class="dropdown-text">Week 06</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../computational-social-sciences/week07.html">
 <span class="dropdown-text">Week 07</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../computational-social-sciences/week08.html">
 <span class="dropdown-text">Week 08</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../computational-social-sciences/week09.html">
 <span class="dropdown-text">Week 09</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../computational-social-sciences/week10.html">
 <span class="dropdown-text">Week 10</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../computational-social-sciences/week11.html">
 <span class="dropdown-text">Week 11</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../computational-social-sciences/week12.html">
 <span class="dropdown-text">Week 12</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../computational-social-sciences/week13.html">
 <span class="dropdown-text">Week 13</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../computational-social-sciences/week14.html">
 <span class="dropdown-text">Week 14</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-right">
      <div class="quarto-title-block"><div><h1 class="title">Experimental Sociology - Week 13</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
            <p class="subtitle lead">Randomization</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-right">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">2025-07-02</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link active" data-scroll-target="#learning-goals">Learning goals</a></li>
  <li><a href="#basic-randomization-techniques" id="toc-basic-randomization-techniques" class="nav-link" data-scroll-target="#basic-randomization-techniques">Basic Randomization Techniques</a>
  <ul class="collapse">
  <li><a href="#the-core-principle" id="toc-the-core-principle" class="nav-link" data-scroll-target="#the-core-principle">The Core Principle</a></li>
  <li><a href="#simple-randomization" id="toc-simple-randomization" class="nav-link" data-scroll-target="#simple-randomization">Simple Randomization</a></li>
  <li><a href="#complete-randomization" id="toc-complete-randomization" class="nav-link" data-scroll-target="#complete-randomization">Complete Randomization</a></li>
  </ul></li>
  <li><a href="#advanced-randomization-techniques" id="toc-advanced-randomization-techniques" class="nav-link" data-scroll-target="#advanced-randomization-techniques">Advanced Randomization Techniques</a>
  <ul class="collapse">
  <li><a href="#block-randomization" id="toc-block-randomization" class="nav-link" data-scroll-target="#block-randomization">Block Randomization</a></li>
  <li><a href="#factorial-designs" id="toc-factorial-designs" class="nav-link" data-scroll-target="#factorial-designs">Factorial Designs</a></li>
  <li><a href="#cluster-randomization" id="toc-cluster-randomization" class="nav-link" data-scroll-target="#cluster-randomization">Cluster Randomization</a>
  <ul class="collapse">
  <li><a href="#two-ways-to-account-for-clustering" id="toc-two-ways-to-account-for-clustering" class="nav-link" data-scroll-target="#two-ways-to-account-for-clustering">Two Ways to Account for Clustering</a></li>
  <li><a href="#spillover-designs" id="toc-spillover-designs" class="nav-link" data-scroll-target="#spillover-designs">Spillover Designs</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#ethics-of-randomization" id="toc-ethics-of-randomization" class="nav-link" data-scroll-target="#ethics-of-randomization">Ethics of Randomization</a>
  <ul class="collapse">
  <li><a href="#when-is-randomization-ethical" id="toc-when-is-randomization-ethical" class="nav-link" data-scroll-target="#when-is-randomization-ethical">When Is Randomization Ethical?</a></li>
  <li><a href="#when-is-randomization-problematic" id="toc-when-is-randomization-problematic" class="nav-link" data-scroll-target="#when-is-randomization-problematic">When Is Randomization Problematic?</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">🧩 Conclusion</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-right" id="quarto-document-content">





<p>This week, we will explore the role of <strong>randomization techniques</strong> in experimental design—and how they can significantly influence <strong>statistical power</strong>, <strong>causal inference</strong>, and even the <strong>ethics</strong> of your study.</p>
<p>As we saw in <a href="week12.html#why-use-unequal-sample-sizes">last week’s chapter</a>, power is maximized when sample sizes are balanced across treatment and control groups. Yet, the most basic form of randomization—<strong>naive or simple randomization</strong>—assigns units independently with fixed probability, such as flipping a fair coin for each unit (e.g.&nbsp;participants, groups, or worlds). While simple, this approach can result in <strong>imbalance</strong> between control and treatment groups, leading to a <strong>loss of power</strong>.</p>
<p>For example, even a modest imbalance such as 17 vs.&nbsp;23 (out of 40 total units) was enough to reduce power from 92% to below 80% in <a href="week12.html#why-use-unequal-sample-sizes">our earlier simulation</a>. This motivates a more thoughtful approach: <strong>randomization is not just a procedural step—it’s a design decision</strong>. This week, we’ll learn why, when, and how to use smarter randomization strategies</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Throughout this chapter, we will use the <code>randomizr</code> package, a versatile R toolkit that provides a wide range of functions for random assignment and random sampling—making it easy to implement complex experimental designs with reproducibility and precision.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("randomizr")  </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomizr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<section id="learning-goals" class="level2">
<h2 class="anchored" data-anchor-id="learning-goals">Learning goals</h2>
<ol type="1">
<li>Understand how different randomization methods impact balance, bias, and power.</li>
<li>Implement common randomization techniques in R using packages like <code>randomizr</code> and <code>blockTools</code>.</li>
<li>Recognize the trade-offs and ethical implications of various random assignment designs.</li>
</ol>
</section>
<section id="basic-randomization-techniques" class="level1">
<h1>Basic Randomization Techniques</h1>
<p>At its core, <strong>randomization is a tool for ensuring internal validity</strong>. It helps us isolate the causal effect of a treatment by addressing a key challenge in empirical research: <strong>unobserved heterogeneity</strong>.</p>
<p>In real-world data, individuals (or more general units) differ in countless observable and unobservable ways—age, motivation, experience, attitudes, prior exposure, etc. If these characteristics are correlated with treatment assignment, any difference in outcomes could be due to <strong>selection bias</strong>, not the treatment itself.</p>
<p>Randomization solves this problem by:</p>
<ul>
<li><p><strong>Breaking the link</strong> between pre-existing characteristics and treatment assignment.</p></li>
<li><p>Ensuring that <strong>treatment and control groups are statistically equivalent in expectation</strong>.</p></li>
<li><p>Making it valid to attribute any post-treatment difference in outcomes to the treatment itself.</p></li>
</ul>
<p>This allows researchers to <strong>infer causality</strong>, not just correlation.</p>
<section id="the-core-principle" class="level3">
<h3 class="anchored" data-anchor-id="the-core-principle">The Core Principle</h3>
<p>In all forms of randomization, the basic idea is the same:</p>
<blockquote class="blockquote">
<p><strong>Every unit has a known, non-zero probability of being assigned to any treatment condition.</strong></p>
</blockquote>
<p>In most experimental designs, this means that <strong>each unit has the same chance</strong> of being assigned to the treatment or control group. This uniform probability guarantees fairness and eliminates systematic bias in treatment assignment.</p>
<p>Importantly, this does <em>not</em> mean that the treatment effect will be perfectly measured in every sample—but it does mean that <strong>across many repetitions</strong>, the estimate will be unbiased and consistent.</p>
</section>
<section id="simple-randomization" class="level2">
<h2 class="anchored" data-anchor-id="simple-randomization">Simple Randomization</h2>
<p>One of the most straightforward randomization techniques is <strong>simple randomization</strong>. Here, each unit is assigned to a treatment or control condition completely independently of all others, typically with a 50/50 probability. This mirrors the process of flipping a fair coin for each participant.</p>
<p>The main advantages of this method are:</p>
<ul>
<li><p>It’s conceptually simple.</p></li>
<li><p>Each assignment is independent.</p></li>
<li><p>There is no need to track previous assignments.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">simple_ra</span>(<span class="at">N=</span><span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 0  1 
45 55 </code></pre>
</div>
</div>
<p>However, the simplicity comes at a cost: <strong>imbalance is likely</strong>. As seen in the output above, even with 100 participants, we might not get a perfectly balanced allocation. This imbalance reduces <strong>statistical power</strong> and can lead to less precise estimates, particularly in smaller samples.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>randomizr</code> package provides extensive flexibility with sensible defaults. Check the full documentation here: <a href="https://declaredesign.org/r/randomizr/reference/" class="uri">https://declaredesign.org/r/randomizr/reference/</a></p>
</div>
</div>
</section>
<section id="complete-randomization" class="level2">
<h2 class="anchored" data-anchor-id="complete-randomization">Complete Randomization</h2>
<p>To avoid the imbalance problem of simple randomization, we can use <strong>complete randomization</strong>. This method assigns units to conditions <strong>while enforcing equal or near-equal group sizes</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">complete_ra</span>(<span class="at">N=</span><span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 0  1 
50 50 </code></pre>
</div>
</div>
<p>Complete randomization ensures that group sizes are as equal as mathematically possible. If <code>N</code> is not divisible by the number of conditions, the remaining units are distributed randomly across the groups.</p>
<p>For example, with three treatment arms:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">complete_ra</span>(<span class="at">N =</span> <span class="dv">100</span>, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">conditions =</span> <span class="fu">c</span>(<span class="st">"control"</span>, <span class="st">"treatment 1"</span>, <span class="st">"treatment 2"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">|&gt;</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    control treatment 1 treatment 2 
         33          33          34 </code></pre>
</div>
</div>
<p>As you can see, the 100 units are divided as evenly as possible across the three conditions (e.g., 33, 33, 34). The slight imbalance due to rounding is distributed randomly.</p>
<p>When feasible, prefer <strong>complete randomization</strong> over simple randomization—especially in small to medium-sized experiments—because better balance leads to better power and clearer interpretation.</p>
</section>
</section>
<section id="advanced-randomization-techniques" class="level1">
<h1>Advanced Randomization Techniques</h1>
<section id="block-randomization" class="level2">
<h2 class="anchored" data-anchor-id="block-randomization">Block Randomization</h2>
<p><strong>Block randomization</strong> (also known as <strong>stratified randomization</strong>) is a powerful method to ensure balance across treatment and control groups along key covariates—such as gender, age, or region. It is particularly helpful in small to moderate sample sizes, where <strong>imbalance due to chance</strong> can significantly reduce statistical power.</p>
<p>Imagine you want to test a treatment in Germany, where 80% of people live in the west and only 20% in the east. Suppose regional background influences the outcome you’re measuring (e.g., political preferences or economic outlook). If you assign treatment using <strong>complete randomization</strong>, the eastern subgroup—being small—could easily end up unevenly distributed between treatment and control. This would introduce <strong>unnecessary variance</strong> into your estimates, making it harder to detect a real effect.</p>
<p>With <strong>block randomization</strong>, you can avoid this issue by dividing units into blocks (e.g., by region) and <strong>randomizing within each block</strong>. This preserves random assignment while ensuring group balance on important covariates—thus improving precision and power.</p>
<p>Let’s see this in action:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">west       =</span> <span class="fu">rbinom</span>(<span class="dv">100</span>, <span class="dv">1</span>, <span class="fl">0.8</span>),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">assignment =</span> <span class="fu">block_ra</span>(west)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(df, <span class="fu">table</span>(assignment, west))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          west
assignment  0  1
         0 11 39
         1 10 40</code></pre>
</div>
</div>
<p>As you can see, block randomization results in near-perfect balance within each region. Each subgroup has its own mini-randomization, which controls covariate imbalance by design.</p>
<p>We now simulate a scenario where both the treatment and the covariate <code>west</code> influence the outcome. We’ll compare <strong>block randomization</strong> to <strong>complete randomization</strong> across a range of sample sizes and track how much power we gain.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>get_data <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  N, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">block =</span> <span class="cn">FALSE</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect_west =</span> <span class="dv">2</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect_treatment =</span> <span class="fl">1.5</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># e.g. 80% of the people come from the west (1)</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  west <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N, <span class="dv">1</span>, <span class="fl">0.8</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># either block or complete randomization</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  treatment <span class="ot">&lt;-</span> <span class="cf">if</span> (block) <span class="fu">block_ra</span>(west) <span class="cf">else</span> <span class="fu">complete_ra</span>(N)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assign treatment and covariate effects</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  outcome   <span class="ot">&lt;-</span> effect_treatment <span class="sc">*</span> treatment <span class="sc">+</span> effect_west <span class="sc">*</span> west <span class="sc">+</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return data</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(west, treatment, outcome)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>run_test <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get power</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(outcome <span class="sc">~</span> treatment, <span class="at">data =</span> df)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit)<span class="sc">$</span>coefficients[<span class="st">"treatment"</span>, <span class="st">"Pr(&gt;|t|)"</span>]</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  pval <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>run_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(N, block) {</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">get_data</span>(N, <span class="at">block =</span> block)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">run_test</span>(df)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get estimated power + binomial CI</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>get_power_ci <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  N, </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">block =</span> <span class="cn">FALSE</span>,</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">replications =</span> <span class="dv">1000</span> </span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  significant_results <span class="ot">&lt;-</span> <span class="fu">replicate</span>(replications, <span class="fu">run_sim</span>(N, block))</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">sum</span>(significant_results)</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(x, replications)             <span class="co"># approximate 95% CI</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">N        =</span> N,</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">design   =</span> <span class="cf">if</span> (block) <span class="st">"Block"</span> <span class="cf">else</span> <span class="st">"Complete"</span>,</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">power    =</span> x <span class="sc">/</span> replications,</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower    =</span> pt<span class="sc">$</span>conf.int[<span class="dv">1</span>],</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper    =</span> pt<span class="sc">$</span>conf.int[<span class="dv">2</span>]</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Run over N = 20 to 50</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="fu">seq</span>(<span class="dv">20</span>,<span class="dv">50</span>,<span class="at">by=</span><span class="dv">2</span>), <span class="sc">~</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_power_ci</span>(.x, <span class="at">block =</span> <span class="cn">FALSE</span>, <span class="at">replications =</span> <span class="dv">1000</span>),</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_power_ci</span>(.x, <span class="at">block =</span>  <span class="cn">TRUE</span>, <span class="at">replications =</span> <span class="dv">1000</span>)</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s plot estimated power across different sample sizes for both designs, including confidence intervals:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R Code (Power plot)</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build interactive Plotly plot</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  results,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="sc">~</span>N, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="sc">~</span>power, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="sc">~</span>design,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"scatter"</span>, <span class="at">mode =</span> <span class="st">"lines+markers"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">error_y =</span> <span class="fu">list</span>(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"data"</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">symmetric =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">array   =</span> <span class="sc">~</span>upper <span class="sc">-</span> power,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrayminus =</span> <span class="sc">~</span>power <span class="sc">-</span> lower</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">hovertemplate =</span> <span class="fu">paste</span>(</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"N = %{x}&lt;br&gt;"</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Power = %{y:.2f}&lt;br&gt;"</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Power vs. Sample Size for Block vs. Complete Randomization"</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Sample Size (N)"</span>),</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Estimated Power"</span>),</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Design"</span>))</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-power" class="cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-power-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="plotly html-widget html-fill-item" id="htmlwidget-4d5b4ee56d7767bb01d2" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-4d5b4ee56d7767bb01d2">{"x":{"visdat":{"115ca97520":["function () ","plotlyVisDat"]},"cur_data":"115ca97520","attrs":{"115ca97520":{"x":{},"y":{},"mode":"lines+markers","error_y":{"type":"data","symmetric":false,"array":{},"arrayminus":{}},"hovertemplate":"N = %{x}<br> Power = %{y:.2f}<br>","color":{},"colors":["blue","red"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Power vs. Sample Size for Block vs. Complete Randomization","xaxis":{"domain":[0,1],"automargin":true,"title":"Sample Size (N)"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Estimated Power"},"legend":{"title":{"text":"Design"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50],"y":[0.72799999999999998,0.80600000000000005,0.82399999999999995,0.878,0.89300000000000002,0.91600000000000004,0.93000000000000005,0.95199999999999996,0.96099999999999997,0.96899999999999997,0.97499999999999998,0.99099999999999999,0.98699999999999999,0.99399999999999999,0.996,0.995],"mode":"lines+markers","error_y":{"color":"rgba(0,0,255,1)","type":"data","symmetric":false,"array":[0.028199672964482336,0.027151038471496247,0.026712596072955175,0.023792809568844109,0.024682315660715548,0.022822448696569797,0.022304020411232361,0.01931379129965527,0.021823059507101839,0.018136094411388193,0.020042978381539789,0.016093172234169284,0.018933025513650836,0.014669960333139054,0.016840777462964862,0.012039991961606322],"arrayminus":[0.029726011398134466,0.028927598917592556,0.028583138667039543,0.026182418653589723,0.02692990960656616,0.025354545277941343,0.024907577078947418,0.022277812903312877,0.024490279152706074,0.021222033183601163,0.0229263181695053,0.019369058560233521,0.021937554440403573,0.018064268762132074,0.020050073851259342,0.015628584516577226]},"hovertemplate":["N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>"],"type":"scatter","name":"Block","marker":{"color":"rgba(0,0,255,1)","line":{"color":"rgba(0,0,255,1)"}},"textfont":{"color":"rgba(0,0,255,1)"},"error_x":{"color":"rgba(0,0,255,1)"},"line":{"color":"rgba(0,0,255,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50],"y":[0.69599999999999995,0.73999999999999999,0.78800000000000003,0.83299999999999996,0.84099999999999997,0.86799999999999999,0.88300000000000001,0.90800000000000003,0.92600000000000005,0.94199999999999995,0.94699999999999995,0.95999999999999996,0.96699999999999997,0.97299999999999998,0.97599999999999998,0.98399999999999999],"mode":"lines+markers","error_y":{"color":"rgba(255,0,0,1)","type":"data","symmetric":false,"array":[0.015093097330534655,0.010766279002323742,0.01330679023731951,0.0094914919722016711,0.012690398880122356,0.0084153443102119585,0.010915285164561306,0.0046015028665071789,0.0098253141593803717,0.0057560286117823711,0.0087877820579868038,0.0035586610508538952,0.0082233013048705894,0.0027178684820535759,0.0065093274611925933,0.003157777888534774],"arrayminus":[0.018453277476066288,0.014439729729757489,0.016805385528558925,0.013245464042835886,0.016233551098082111,0.012235026209338251,0.014579062424823208,0.0086644779117074355,0.01355854556628755,0.0097393739144536751,0.012584877045793141,0.0077062775835909925,0.012054591629974909,0.0069500955477197479,0.010444869261270973,0.0073433251930679067]},"hovertemplate":["N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>","N = %{x}<br> Power = %{y:.2f}<br>"],"type":"scatter","name":"Complete","marker":{"color":"rgba(255,0,0,1)","line":{"color":"rgba(255,0,0,1)"}},"textfont":{"color":"rgba(255,0,0,1)"},"error_x":{"color":"rgba(255,0,0,1)"},"line":{"color":"rgba(255,0,0,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-power-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: The power in our simulations.
</figcaption>
</figure>
</div>
</div>
<p>This simulation demonstrates how <strong>block randomization consistently outperforms complete randomization</strong>, especially when statistical power hovers around the 60–90% range—precisely where most experiments aim to land.</p>
<p>In our simulation, <strong>80% power</strong> is reached at:</p>
<ul>
<li><p>Block randomization: 22</p></li>
<li><p>Complete randomization: 26</p></li>
</ul>
<p>This shows that block randomization can achieve desired power levels <strong>with fewer units</strong>—a real advantage when resources are limited or units are hard to recruit.</p>
<p>This can even be further increased if we would have controlled for the variable <code>west</code> in the linear regression we used here to test whether the effect is significant or not.</p>
</section>
<section id="factorial-designs" class="level2">
<h2 class="anchored" data-anchor-id="factorial-designs">Factorial Designs</h2>
<p>A <strong>factorial design</strong> is an experimental setup in which <strong>two or more factors are varied simultaneously</strong>, allowing researchers to study not only the <strong>individual effects</strong> of each factor (main effects), but also their <strong>interactions</strong>. The most basic version is a <strong>2×2 factorial design</strong>, where each of two factors has two levels. This results in <strong>four unique combinations</strong> (2 × 2 = 4).</p>
<p>Factorial designs are especially useful when:</p>
<ul>
<li><p>You want to test multiple interventions at once,</p></li>
<li><p>You are interested in <strong>interaction effects</strong> (e.g., whether A is only effective when B is also present),</p></li>
<li><p>You want to maximize efficiency by getting multiple tests out of a single experiment.</p></li>
</ul>
<p>Suppose you’re testing how political messages influence public opinion. You vary on the one hand the political orientation of the message: <em>left-leaning</em> vs.&nbsp;<em>right-leaning</em>, and the strength of the message: <em>soft</em> vs.&nbsp;<em>strong</em> rhetoric:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">msg_strength =</span> <span class="fu">complete_ra</span>(<span class="dv">100</span>, <span class="dv">40</span>, <span class="at">conditions =</span> <span class="fu">c</span>(<span class="st">"weak"</span>, <span class="st">"strong"</span>) ), <span class="co"># 60:40</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">msg_orientation =</span> <span class="fu">block_ra</span>(msg_strength, <span class="at">conditions =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"right"</span>))  <span class="co"># 50:50</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(df, <span class="fu">table</span>(msg_strength, msg_orientation))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            msg_orientation
msg_strength left right
      weak     30    30
      strong   20    20</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Full vs.&nbsp;Fractional Factorial Designs
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>A <strong>full factorial design</strong> includes <strong>all possible combinations</strong> of the factors.</p></li>
<li><p>A (<strong>fractional</strong>) <strong>factorial design</strong> includes <strong>only a subset</strong> of combinations, often used when the total number of combinations is too large to be practical (e.g., in conjoint experiments or vignette studies).</p></li>
</ul>
</div>
</div>
</section>
<section id="cluster-randomization" class="level2">
<h2 class="anchored" data-anchor-id="cluster-randomization">Cluster Randomization</h2>
<p>In many applied contexts, <strong>randomization must occur at the group or “cluster” level</strong>—for example, assigning entire schools, villages, or social networks to a treatment condition rather than individual units. This often isn’t the ideal from a statistical perspective. Ideally, we would randomize <strong>individuals</strong>, because this generally yields the <strong>highest statistical power</strong>. But in practice, that’s often not possible.</p>
<p>Let’s consider education as an example. Suppose we want to measure <strong>learning outcomes</strong> in elementary school. While the outcome—test performance—is measured at the individual level (the student), the <strong>treatment</strong> might inherently apply to the entire group:</p>
<ul>
<li><p>If a class gets an additional lesson per week, it affect the <strong>entire class</strong>.</p></li>
<li><p>If you give a teacher training, it spills over into <strong>every class</strong> the teacher teaches.</p></li>
<li><p>If an educational policy is implemented at the <strong>school</strong> or <strong>district</strong> level, it applies to all students within those units.</p></li>
</ul>
<p>In such cases, individual-level randomization would not be feasible or meaningful. Instead, we randomize entire <strong>clusters</strong>—like classes, schools, or even regions.</p>
<p>To understand how different randomization strategies affect assignment—and ultimately power—let’s simulate a school system. We assume:</p>
<ul>
<li>4 schools</li>
<li>Each school has 4 classes</li>
<li>Each class has 4 students</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">school  =</span> <span class="fu">factor</span>(<span class="fu">paste0</span>(<span class="st">"School "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)), <span class="co"># four schools</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">class   =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,                            <span class="co"># in each school four classes</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">student =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>                             <span class="co"># in each class four students</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s assume that:</p>
<ul>
<li>Test scores follow a normal distribution (mean = 50, SD = 10),</li>
<li>School 1 is 5 points better than the rest,</li>
<li>A treatment effect of +10 points is applied (Cohen’s d ≈ 1).</li>
</ul>
<p>We now apply several different randomization designs:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1337</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>effect_treatment <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>df_all <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span> <span class="co"># 1) Simple</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">design    =</span> <span class="st">"Simple"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="fu">simple_ra</span>(<span class="at">N =</span> <span class="fu">n</span>())   </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span> <span class="co"># 2) Complete</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">design    =</span> <span class="st">"Complete"</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="fu">complete_ra</span>(<span class="at">N =</span> <span class="fu">n</span>())   </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span> <span class="co"># 3) Block - School</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">design    =</span> <span class="st">"Block (School)"</span>,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="fu">block_ra</span>(school)  </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span> <span class="co"># 4) Cluster - School</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">design    =</span> <span class="st">"Cluster (School)"</span>,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="fu">cluster_ra</span>(school)  </span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span> <span class="co"># 5) Cluster - Class &amp; School</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">design    =</span> <span class="st">"Cluster (School &amp; Class)"</span>,</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="fu">cluster_ra</span>(<span class="fu">interaction</span>(school, class, <span class="at">drop =</span> <span class="cn">TRUE</span>)) <span class="co"># compute factor interactions</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span> <span class="co"># 6) Cluster &amp; Block - Grade &amp; School</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">design     =</span> <span class="st">"Block (S.) &amp; Cluster (S.&amp;C.)"</span>,</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment  =</span> <span class="fu">block_and_cluster_ra</span>(</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">clusters =</span> <span class="fu">interaction</span>(school, class, <span class="at">drop =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">blocks   =</span> school</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>) <span class="sc">+</span>     <span class="co"># random noise (sd=10)</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>              effect_treatment <span class="sc">*</span> treatment <span class="sc">+</span>       <span class="co"># treatment effect</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>              <span class="fu">if_else</span>(school <span class="sc">==</span> <span class="st">"School 1"</span>, <span class="dv">5</span>, <span class="dv">0</span>)  <span class="co"># school one 1 is 5 points better </span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#fig-random-designs" class="quarto-xref">Figure&nbsp;2</a> shows how treatment is distributed under each design:</p>
<ul>
<li><p><strong>Simple</strong> (top-left) more students are treated than not.</p></li>
<li><p><strong>Complete</strong> (top-middle) ensures overall balance but can result in imbalanced clusters (e.g.&nbsp;school 1 &amp; 3).</p></li>
<li><p><strong>Block (School)</strong> (top-right) balances treatment assignments <strong>within each school</strong>, improving comparability.</p></li>
<li><p><strong>Cluster (School)</strong> (bottom-left) assigns <strong>entire schools</strong> to treatment or control.</p></li>
<li><p><strong>Cluster (School &amp; Class)</strong> (bottom-middle) strikes a balance: it assigns whole class-level units to treatment while still keeping some diversity within schools. Yet is is not assured that treated classes in a given school are balanced (e.g.&nbsp;School 2 &amp; 4).</p></li>
<li><p><strong>Block (School) &amp; Cluster (School &amp; Class)</strong> (bottom-right) similar to cluster randomization over school and class but with a balanced set of classes per school.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># make one plot per design</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> df_all <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(.<span class="sc">$</span>design) <span class="sc">%&gt;%</span>  </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="cf">function</span>(dd){</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(dd, </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> student, <span class="at">y =</span> class, <span class="at">fill =</span> <span class="fu">factor</span>(treatment))) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>(<span class="at">colour =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>      <span class="co"># map 0 → teal, 1 → red</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"#357ABD"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"#F56565"</span>)) <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> school, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>( <span class="at">title =</span> dd<span class="sc">$</span>design) <span class="sc">+</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title       =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text        =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks       =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid       =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey80"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text       =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title       =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.spacing    =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"lines"</span>),</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position   =</span> <span class="st">"none"</span>,    <span class="co"># remove legend</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="co"># assemble into a 2x2 grid</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> (plots[[<span class="dv">6</span>]] <span class="sc">|</span> plots[[<span class="dv">5</span>]] <span class="sc">|</span> plots[[<span class="dv">2</span>]]) <span class="sc">/</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>            (plots[[<span class="dv">4</span>]] <span class="sc">|</span> plots[[<span class="dv">3</span>]] <span class="sc">|</span> plots[[<span class="dv">1</span>]])</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>combined</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-random-designs" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-random-designs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="week13_files/figure-html/fig-random-designs-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;2: Patterns of different random assignment designs. Each row represents a different class, and each cell a different student. Colors indicate treatment assignment (Blue = Control, Red = Treatment)."><img src="week13_files/figure-html/fig-random-designs-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-random-designs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Patterns of different random assignment designs. Each row represents a different class, and each cell a different student. Colors indicate treatment assignment (Blue = Control, Red = Treatment).
</figcaption>
</figure>
</div>
</div>
</div>
<p>Although clustering may be necessary, it comes at a <strong>cost to statistical power</strong>. Why? Because observations within clusters are <strong>not independent</strong>. If a teacher affects all their students, then those students’ outcomes are correlated—not independent replicates.</p>
<p>Let’s see the consequences of this. Suppose we analyze the “Cluster (School)” design with a standard t-test:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(outcome <span class="sc">~</span> treatment, <span class="at">data =</span> df_all <span class="sc">|&gt;</span> <span class="fu">filter</span>(design <span class="sc">==</span> <span class="st">"Cluster (School)"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  outcome by treatment
t = -4.5496, df = 61.98, p-value = 2.56e-05
alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
95 percent confidence interval:
 -15.244547  -5.937612
sample estimates:
mean in group 0 mean in group 1 
       50.00333        60.59441 </code></pre>
</div>
</div>
<p>We get a highly significant result (<span class="math inline">\(p &lt; 0.001\)</span>)—but this is misleading. The test treats all 64 students as independent, which violates assumptions.</p>
<section id="two-ways-to-account-for-clustering" class="level3">
<h3 class="anchored" data-anchor-id="two-ways-to-account-for-clustering">Two Ways to Account for Clustering</h3>
<ol type="1">
<li><strong>Aggregating to the Cluster Level</strong></li>
</ol>
<p>Instead of treating each student as a separate unit, we summarize outcomes at the school level:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(outcome <span class="sc">~</span> treatment, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">data =</span> df_all <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(design <span class="sc">==</span> <span class="st">"Cluster (School)"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">group_by</span>(school, treatment)  <span class="sc">|&gt;</span>           <span class="co"># while it is useless to group by "treatment", it keeps the variable</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">summarize</span>(<span class="at">outcome =</span> <span class="fu">mean</span>(outcome), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  outcome by treatment
t = -3.2581, df = 1.2323, p-value = 0.1507
alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
95 percent confidence interval:
 -37.36402  16.18186
sample estimates:
mean in group 0 mean in group 1 
       50.00333        60.59441 </code></pre>
</div>
</div>
<p>Now, the test is no longer significant (p = 0.151). We reduced pseudo-replication by correctly using the cluster as the unit of analysis. But we also lost power because we only have 4 clusters (schools).</p>
<ol start="2" type="1">
<li><strong>Using Hierarchical Models (e.g., Mixed Effects)</strong></li>
</ol>
<p>An alternative is to use a random effects or multilevel model that accounts for the hierarchical structure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lmer</span>(outcome <span class="sc">~</span> treatment <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> school), <span class="at">data =</span> df_all <span class="sc">|&gt;</span> <span class="fu">filter</span>(design <span class="sc">==</span> <span class="st">"Cluster (School)"</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: outcome ~ treatment + (1 | school)
   Data: filter(df_all, design == "Cluster (School)")

REML criterion at convergence: 459

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-1.86844 -0.65734 -0.05196  0.57263  2.29809 

Random effects:
 Groups   Name        Variance Std.Dev.
 school   (Intercept)  5.32    2.306   
 Residual             83.96    9.163   
Number of obs: 64, groups:  school, 4

Fixed effects:
            Estimate Std. Error t value
(Intercept)   50.003      2.299  21.754
treatment     10.591      3.251   3.258

Correlation of Fixed Effects:
          (Intr)
treatment -0.707</code></pre>
</div>
</div>
<p>This approach retains individual-level data, while correctly modeling the correlation within clusters.</p>
<p>Another problem is that if the clusters differ <strong>systematically</strong> in ways that affect the outcome—say, wealthier schools tend to be assigned more likely to the treatment—we risk <strong>bias</strong> or inflated variance unless properly controlled for. If you look at <a href="#fig-random-designs" class="quarto-xref">Figure&nbsp;2</a> the cluster assignment for schools would not allow us to differentiate between treatment effect and effects of school 1 &amp; 3.</p>
</section>
<section id="spillover-designs" class="level3">
<h3 class="anchored" data-anchor-id="spillover-designs">Spillover Designs</h3>
<p>While we talked about clustering and how it is sometimes not avoidable, sometimes it is and we want to do it anyways! This is the case when we assume sp called <strong>spillover effects</strong>. <strong>Spillovers</strong> (also called <strong>interference</strong> or <strong>externalities</strong>) occur when the treatment assigned to one unit influences the <strong>outcomes of other units</strong>. This violates a common assumption in experimental design called the <strong>Stable Unit Treatment Value Assumption (SUTVA)</strong>, which states that a unit’s potential outcomes depend only on its own treatment status—not on the treatment status of others.</p>
<p>Spillovers can arise in many contexts:</p>
<ul>
<li><strong>Education</strong>: A student receiving extra tutoring may affect classmates through peer learning.</li>
<li><strong>Public health</strong>: Vaccinating some individuals may reduce transmission risk for unvaccinated individuals.</li>
<li><strong>Politics</strong>: Exposing one person to a political campaign can influence friends or family they talk to.</li>
</ul>
<p>But they’re not always bad! Sometimes <strong>estimating spillovers is the goal</strong>, and designs can be tailored to <strong>identify both direct and indirect effects</strong>.</p>
<p>If you suspect spillovers might exist, don’t ignore them—design around them with a two-stage randomization (or double randomization)**</p>
<p>Randomly assign:</p>
<ul>
<li>Some clusters to complete treatment,</li>
<li>Some clusters to complete control,</li>
<li>And some clusters to mixed control and treatment.</li>
</ul>
<p>This allows you to estimate:</p>
<ul>
<li><strong>Direct effects</strong> (treated vs untreated within treated clusters),</li>
<li><strong>Spillover effects</strong> (untreated in treated clusters vs untreated in control clusters),</li>
<li><strong>Total effects</strong> (treated in treated clusters vs untreated in control clusters).</li>
</ul>
</section>
</section>
</section>
<section id="ethics-of-randomization" class="level1">
<h1>Ethics of Randomization</h1>
<p><strong>Randomization</strong> is a foundational tool for identifying causal effects in experimental research. From a design perspective, it helps ensure that treatment assignment is not biased by unobserved factors. However, <strong>randomization also raises important ethical questions</strong>, particularly when it involves real-world interventions that affect people’s lives.</p>
<section id="when-is-randomization-ethical" class="level3">
<h3 class="anchored" data-anchor-id="when-is-randomization-ethical">When Is Randomization Ethical?</h3>
<p>In the <strong>long term</strong>, randomization can be an ethical way to allocate limited resources. By rigorously testing which programs or policies are most effective, researchers help ensure that future investments deliver maximum benefit. Randomization also avoids allocation based on arbitrary or potentially biased criteria.</p>
<p>In the <strong>short term</strong>, randomization may be seen as a fair method when demand for a program exceeds supply. Instead of selecting beneficiaries based on subjective judgments, random assignment can distribute access in a transparent and impartial way.</p>
</section>
<section id="when-is-randomization-problematic" class="level3">
<h3 class="anchored" data-anchor-id="when-is-randomization-problematic">When Is Randomization Problematic?</h3>
<p>However, randomization is not always ethically neutral. Consider a program that provides loans. If we randomly assign loans to both low-income and high-income individuals, we may end up <strong>diverting resources away from those who need them most</strong>. If the treatment is already believed to be beneficial, denying it to vulnerable populations for the sake of experimentation can be ethically troubling.</p>
<p>In such cases, <strong>researchers must weigh the social value of the experiment against the potential harm</strong>. Where possible, designs should be structured to <strong>ultimately benefit all participants</strong>, including those initially assigned to control.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>🧩 Conclusion</h1>
<p>Randomization is not just a technical procedure—it’s the backbone of credible causal inference. In this chapter, we explored a variety of randomization techniques, from simple and complete randomization to more advanced methods like block and cluster randomization, factorial designs, and waitlist approaches. Each method has its trade-offs, and understanding when and how to use them is crucial for designing effective experiments.</p>
<p>We saw that <strong>simple randomization</strong>, while easy to implement, can lead to imbalance—especially in smaller samples—reducing power. <strong>Block randomization</strong> improves balance on known covariates and can significantly increase statistical power without increasing sample size. <strong>Cluster randomization</strong>, though sometimes necessary, comes with a cost to power due to reduced unit independence. <strong>Factorial designs</strong> allow us to test multiple treatments efficiently, while <strong>spillover-aware designs</strong> help us understand broader causal dynamics in interconnected settings.</p>
<p>Importantly, we also discussed the <strong>ethical dimensions</strong> of random assignment. While randomization is often the fairest way to allocate scarce resources, it must be used responsibly and transparently.</p>
<p>Ultimately, good experimental design balances <strong>rigor, feasibility, and ethics</strong>. As researchers, our goal is not only to identify what works, but to do so in a way that is scientifically valid, practically useful, and ethically sound.</p>


<!-- -->

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-copyright"><h2 class="anchored quarto-appendix-heading">Copyright</h2><div class="quarto-appendix-contents"><div>Copyright Sascha Grehl, 2025. All Rights Reserved</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb23" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">  title: "Experimental Sociology - Week 13"</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">  subtitle: "Randomization"</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">  date: "2025-07-02"</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>This week, we will explore the role of **randomization techniques** in experimental design—and how they can significantly influence **statistical power**, **causal inference**, and even the **ethics** of your study.</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>As we saw in <span class="co">[</span><span class="ot">last week’s chapter</span><span class="co">](week12.html#why-use-unequal-sample-sizes)</span>, power is maximized when sample sizes are balanced across treatment and control groups. Yet, the most basic form of randomization—**naive or simple randomization**—assigns units independently with fixed probability, such as flipping a fair coin for each unit (e.g. participants, groups, or worlds). While simple, this approach can result in **imbalance** between control and treatment groups, leading to a **loss of power**.</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>For example, even a modest imbalance such as 17 vs. 23 (out of 40 total units) was enough to reduce power from 92% to below 80% in <span class="co">[</span><span class="ot">our earlier simulation</span><span class="co">](week12.html#why-use-unequal-sample-sizes)</span>. This motivates a more thoughtful approach: **randomization is not just a procedural step—it’s a design decision**. This week, we’ll learn why, when, and how to use smarter randomization strategies</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>::: callout-important</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>Throughout this chapter, we will use the <span class="in">`randomizr`</span> package, a versatile R toolkit that provides a wide range of functions for random assignment and random sampling—making it easy to implement complex experimental designs with reproducibility and precision.</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("randomizr")  </span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomizr)</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning goals</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Understand how different randomization methods impact balance, bias, and power.</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Implement common randomization techniques in R using packages like <span class="in">`randomizr`</span> and <span class="in">`blockTools`</span>.</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Recognize the trade-offs and ethical implications of various random assignment designs.</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a><span class="fu"># Basic Randomization Techniques</span></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>At its core, **randomization is a tool for ensuring internal validity**. It helps us isolate the causal effect of a treatment by addressing a key challenge in empirical research: **unobserved heterogeneity**.</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>In real-world data, individuals (or more general units) differ in countless observable and unobservable ways—age, motivation, experience, attitudes, prior exposure, etc. If these characteristics are correlated with treatment assignment, any difference in outcomes could be due to **selection bias**, not the treatment itself.</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>Randomization solves this problem by:</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Breaking the link** between pre-existing characteristics and treatment assignment.</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ensuring that **treatment and control groups are statistically equivalent in expectation**.</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Making it valid to attribute any post-treatment difference in outcomes to the treatment itself.</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>This allows researchers to **infer causality**, not just correlation.</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Core Principle</span></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>In all forms of randomization, the basic idea is the same:</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **Every unit has a known, non-zero probability of being assigned to any treatment condition.**</span></span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>In most experimental designs, this means that **each unit has the same chance** of being assigned to the treatment or control group. This uniform probability guarantees fairness and eliminates systematic bias in treatment assignment.</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>Importantly, this does *not* mean that the treatment effect will be perfectly measured in every sample—but it does mean that **across many repetitions**, the estimate will be unbiased and consistent.</span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simple Randomization</span></span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>One of the most straightforward randomization techniques is **simple randomization**. Here, each unit is assigned to a treatment or control condition completely independently of all others, typically with a 50/50 probability. This mirrors the process of flipping a fair coin for each participant.</span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>The main advantages of this method are:</span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>It’s conceptually simple.</span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Each assignment is independent.</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>There is no need to track previous assignments.</span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a><span class="fu">simple_ra</span>(<span class="at">N=</span><span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>()</span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a>However, the simplicity comes at a cost: **imbalance is likely**. As seen in the output above, even with 100 participants, we might not get a perfectly balanced allocation. This imbalance reduces **statistical power** and can lead to less precise estimates, particularly in smaller samples.</span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a>The <span class="in">`randomizr`</span> package provides extensive flexibility with sensible defaults. Check the full documentation here: <span class="ot">&lt;https://declaredesign.org/r/randomizr/reference/&gt;</span></span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a><span class="fu">## Complete Randomization</span></span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a>To avoid the imbalance problem of simple randomization, we can use **complete randomization**. This method assigns units to conditions **while enforcing equal or near-equal group sizes**.</span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a><span class="fu">complete_ra</span>(<span class="at">N=</span><span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>()</span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a>Complete randomization ensures that group sizes are as equal as mathematically possible. If <span class="in">`N`</span> is not divisible by the number of conditions, the remaining units are distributed randomly across the groups.</span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a>For example, with three treatment arms:</span>
<span id="cb23-106"><a href="#cb23-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-109"><a href="#cb23-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-110"><a href="#cb23-110" aria-hidden="true" tabindex="-1"></a><span class="fu">complete_ra</span>(<span class="at">N =</span> <span class="dv">100</span>, </span>
<span id="cb23-111"><a href="#cb23-111" aria-hidden="true" tabindex="-1"></a>            <span class="at">conditions =</span> <span class="fu">c</span>(<span class="st">"control"</span>, <span class="st">"treatment 1"</span>, <span class="st">"treatment 2"</span>)</span>
<span id="cb23-112"><a href="#cb23-112" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">|&gt;</span> </span>
<span id="cb23-113"><a href="#cb23-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>()</span>
<span id="cb23-114"><a href="#cb23-114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-115"><a href="#cb23-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-116"><a href="#cb23-116" aria-hidden="true" tabindex="-1"></a>As you can see, the 100 units are divided as evenly as possible across the three conditions (e.g., 33, 33, 34). The slight imbalance due to rounding is distributed randomly.</span>
<span id="cb23-117"><a href="#cb23-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-118"><a href="#cb23-118" aria-hidden="true" tabindex="-1"></a>When feasible, prefer **complete randomization** over simple randomization—especially in small to medium-sized experiments—because better balance leads to better power and clearer interpretation.</span>
<span id="cb23-119"><a href="#cb23-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-120"><a href="#cb23-120" aria-hidden="true" tabindex="-1"></a><span class="fu"># Advanced Randomization Techniques</span></span>
<span id="cb23-121"><a href="#cb23-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-122"><a href="#cb23-122" aria-hidden="true" tabindex="-1"></a><span class="fu">## Block Randomization</span></span>
<span id="cb23-123"><a href="#cb23-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-124"><a href="#cb23-124" aria-hidden="true" tabindex="-1"></a>**Block randomization** (also known as **stratified randomization**) is a powerful method to ensure balance across treatment and control groups along key covariates—such as gender, age, or region. It is particularly helpful in small to moderate sample sizes, where **imbalance due to chance** can significantly reduce statistical power.</span>
<span id="cb23-125"><a href="#cb23-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-126"><a href="#cb23-126" aria-hidden="true" tabindex="-1"></a>Imagine you want to test a treatment in Germany, where 80% of people live in the west and only 20% in the east. Suppose regional background influences the outcome you're measuring (e.g., political preferences or economic outlook). If you assign treatment using **complete randomization**, the eastern subgroup—being small—could easily end up unevenly distributed between treatment and control. This would introduce **unnecessary variance** into your estimates, making it harder to detect a real effect.</span>
<span id="cb23-127"><a href="#cb23-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-128"><a href="#cb23-128" aria-hidden="true" tabindex="-1"></a>With **block randomization**, you can avoid this issue by dividing units into blocks (e.g., by region) and **randomizing within each block**. This preserves random assignment while ensuring group balance on important covariates—thus improving precision and power.</span>
<span id="cb23-129"><a href="#cb23-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-130"><a href="#cb23-130" aria-hidden="true" tabindex="-1"></a>Let’s see this in action:</span>
<span id="cb23-131"><a href="#cb23-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-134"><a href="#cb23-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-135"><a href="#cb23-135" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb23-136"><a href="#cb23-136" aria-hidden="true" tabindex="-1"></a>    <span class="at">west       =</span> <span class="fu">rbinom</span>(<span class="dv">100</span>, <span class="dv">1</span>, <span class="fl">0.8</span>),</span>
<span id="cb23-137"><a href="#cb23-137" aria-hidden="true" tabindex="-1"></a>    <span class="at">assignment =</span> <span class="fu">block_ra</span>(west)</span>
<span id="cb23-138"><a href="#cb23-138" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-139"><a href="#cb23-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-140"><a href="#cb23-140" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(df, <span class="fu">table</span>(assignment, west))</span>
<span id="cb23-141"><a href="#cb23-141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-142"><a href="#cb23-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-143"><a href="#cb23-143" aria-hidden="true" tabindex="-1"></a>As you can see, block randomization results in near-perfect balance within each region. Each subgroup has its own mini-randomization, which controls covariate imbalance by design.</span>
<span id="cb23-144"><a href="#cb23-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-145"><a href="#cb23-145" aria-hidden="true" tabindex="-1"></a>We now simulate a scenario where both the treatment and the covariate <span class="in">`west`</span> influence the outcome. We’ll compare **block randomization** to **complete randomization** across a range of sample sizes and track how much power we gain.</span>
<span id="cb23-146"><a href="#cb23-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-149"><a href="#cb23-149" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-150"><a href="#cb23-150" aria-hidden="true" tabindex="-1"></a>get_data <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb23-151"><a href="#cb23-151" aria-hidden="true" tabindex="-1"></a>  N, </span>
<span id="cb23-152"><a href="#cb23-152" aria-hidden="true" tabindex="-1"></a>  <span class="at">block =</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-153"><a href="#cb23-153" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect_west =</span> <span class="dv">2</span>,</span>
<span id="cb23-154"><a href="#cb23-154" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect_treatment =</span> <span class="fl">1.5</span></span>
<span id="cb23-155"><a href="#cb23-155" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb23-156"><a href="#cb23-156" aria-hidden="true" tabindex="-1"></a>  <span class="co"># e.g. 80% of the people come from the west (1)</span></span>
<span id="cb23-157"><a href="#cb23-157" aria-hidden="true" tabindex="-1"></a>  west <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N, <span class="dv">1</span>, <span class="fl">0.8</span>)</span>
<span id="cb23-158"><a href="#cb23-158" aria-hidden="true" tabindex="-1"></a>  <span class="co"># either block or complete randomization</span></span>
<span id="cb23-159"><a href="#cb23-159" aria-hidden="true" tabindex="-1"></a>  treatment <span class="ot">&lt;-</span> <span class="cf">if</span> (block) <span class="fu">block_ra</span>(west) <span class="cf">else</span> <span class="fu">complete_ra</span>(N)</span>
<span id="cb23-160"><a href="#cb23-160" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assign treatment and covariate effects</span></span>
<span id="cb23-161"><a href="#cb23-161" aria-hidden="true" tabindex="-1"></a>  outcome   <span class="ot">&lt;-</span> effect_treatment <span class="sc">*</span> treatment <span class="sc">+</span> effect_west <span class="sc">*</span> west <span class="sc">+</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb23-162"><a href="#cb23-162" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return data</span></span>
<span id="cb23-163"><a href="#cb23-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(west, treatment, outcome)</span>
<span id="cb23-164"><a href="#cb23-164" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-165"><a href="#cb23-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-166"><a href="#cb23-166" aria-hidden="true" tabindex="-1"></a>run_test <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb23-167"><a href="#cb23-167" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get power</span></span>
<span id="cb23-168"><a href="#cb23-168" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(outcome <span class="sc">~</span> treatment, <span class="at">data =</span> df)</span>
<span id="cb23-169"><a href="#cb23-169" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit)<span class="sc">$</span>coefficients[<span class="st">"treatment"</span>, <span class="st">"Pr(&gt;|t|)"</span>]</span>
<span id="cb23-170"><a href="#cb23-170" aria-hidden="true" tabindex="-1"></a>  pval <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb23-171"><a href="#cb23-171" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-172"><a href="#cb23-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-173"><a href="#cb23-173" aria-hidden="true" tabindex="-1"></a>run_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(N, block) {</span>
<span id="cb23-174"><a href="#cb23-174" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">get_data</span>(N, <span class="at">block =</span> block)</span>
<span id="cb23-175"><a href="#cb23-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">run_test</span>(df)</span>
<span id="cb23-176"><a href="#cb23-176" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-177"><a href="#cb23-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-178"><a href="#cb23-178" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get estimated power + binomial CI</span></span>
<span id="cb23-179"><a href="#cb23-179" aria-hidden="true" tabindex="-1"></a>get_power_ci <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb23-180"><a href="#cb23-180" aria-hidden="true" tabindex="-1"></a>  N, </span>
<span id="cb23-181"><a href="#cb23-181" aria-hidden="true" tabindex="-1"></a>  <span class="at">block =</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-182"><a href="#cb23-182" aria-hidden="true" tabindex="-1"></a>  <span class="at">replications =</span> <span class="dv">1000</span> </span>
<span id="cb23-183"><a href="#cb23-183" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb23-184"><a href="#cb23-184" aria-hidden="true" tabindex="-1"></a>  significant_results <span class="ot">&lt;-</span> <span class="fu">replicate</span>(replications, <span class="fu">run_sim</span>(N, block))</span>
<span id="cb23-185"><a href="#cb23-185" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">sum</span>(significant_results)</span>
<span id="cb23-186"><a href="#cb23-186" aria-hidden="true" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(x, replications)             <span class="co"># approximate 95% CI</span></span>
<span id="cb23-187"><a href="#cb23-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb23-188"><a href="#cb23-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">N        =</span> N,</span>
<span id="cb23-189"><a href="#cb23-189" aria-hidden="true" tabindex="-1"></a>    <span class="at">design   =</span> <span class="cf">if</span> (block) <span class="st">"Block"</span> <span class="cf">else</span> <span class="st">"Complete"</span>,</span>
<span id="cb23-190"><a href="#cb23-190" aria-hidden="true" tabindex="-1"></a>    <span class="at">power    =</span> x <span class="sc">/</span> replications,</span>
<span id="cb23-191"><a href="#cb23-191" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower    =</span> pt<span class="sc">$</span>conf.int[<span class="dv">1</span>],</span>
<span id="cb23-192"><a href="#cb23-192" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper    =</span> pt<span class="sc">$</span>conf.int[<span class="dv">2</span>]</span>
<span id="cb23-193"><a href="#cb23-193" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-194"><a href="#cb23-194" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-195"><a href="#cb23-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-196"><a href="#cb23-196" aria-hidden="true" tabindex="-1"></a><span class="co"># Run over N = 20 to 50</span></span>
<span id="cb23-197"><a href="#cb23-197" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="fu">seq</span>(<span class="dv">20</span>,<span class="dv">50</span>,<span class="at">by=</span><span class="dv">2</span>), <span class="sc">~</span></span>
<span id="cb23-198"><a href="#cb23-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb23-199"><a href="#cb23-199" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_power_ci</span>(.x, <span class="at">block =</span> <span class="cn">FALSE</span>, <span class="at">replications =</span> <span class="dv">1000</span>),</span>
<span id="cb23-200"><a href="#cb23-200" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_power_ci</span>(.x, <span class="at">block =</span>  <span class="cn">TRUE</span>, <span class="at">replications =</span> <span class="dv">1000</span>)</span>
<span id="cb23-201"><a href="#cb23-201" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-202"><a href="#cb23-202" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-203"><a href="#cb23-203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-204"><a href="#cb23-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-205"><a href="#cb23-205" aria-hidden="true" tabindex="-1"></a>Now let’s plot estimated power across different sample sizes for both designs, including confidence intervals:</span>
<span id="cb23-206"><a href="#cb23-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-209"><a href="#cb23-209" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-210"><a href="#cb23-210" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-power</span></span>
<span id="cb23-211"><a href="#cb23-211" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: The power in our simulations. </span></span>
<span id="cb23-212"><a href="#cb23-212" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb23-213"><a href="#cb23-213" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb23-214"><a href="#cb23-214" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Show R Code (Power plot)</span></span>
<span id="cb23-215"><a href="#cb23-215" aria-hidden="true" tabindex="-1"></a><span class="co"># Build interactive Plotly plot</span></span>
<span id="cb23-216"><a href="#cb23-216" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(</span>
<span id="cb23-217"><a href="#cb23-217" aria-hidden="true" tabindex="-1"></a>  results,</span>
<span id="cb23-218"><a href="#cb23-218" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="sc">~</span>N, </span>
<span id="cb23-219"><a href="#cb23-219" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="sc">~</span>power, </span>
<span id="cb23-220"><a href="#cb23-220" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="sc">~</span>design,</span>
<span id="cb23-221"><a href="#cb23-221" aria-hidden="true" tabindex="-1"></a>  <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>),</span>
<span id="cb23-222"><a href="#cb23-222" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"scatter"</span>, <span class="at">mode =</span> <span class="st">"lines+markers"</span>,</span>
<span id="cb23-223"><a href="#cb23-223" aria-hidden="true" tabindex="-1"></a>  <span class="at">error_y =</span> <span class="fu">list</span>(</span>
<span id="cb23-224"><a href="#cb23-224" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"data"</span>,</span>
<span id="cb23-225"><a href="#cb23-225" aria-hidden="true" tabindex="-1"></a>    <span class="at">symmetric =</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-226"><a href="#cb23-226" aria-hidden="true" tabindex="-1"></a>    <span class="at">array   =</span> <span class="sc">~</span>upper <span class="sc">-</span> power,</span>
<span id="cb23-227"><a href="#cb23-227" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrayminus =</span> <span class="sc">~</span>power <span class="sc">-</span> lower</span>
<span id="cb23-228"><a href="#cb23-228" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb23-229"><a href="#cb23-229" aria-hidden="true" tabindex="-1"></a>  <span class="at">hovertemplate =</span> <span class="fu">paste</span>(</span>
<span id="cb23-230"><a href="#cb23-230" aria-hidden="true" tabindex="-1"></a>    <span class="st">"N = %{x}&lt;br&gt;"</span>,</span>
<span id="cb23-231"><a href="#cb23-231" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Power = %{y:.2f}&lt;br&gt;"</span></span>
<span id="cb23-232"><a href="#cb23-232" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-233"><a href="#cb23-233" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb23-234"><a href="#cb23-234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb23-235"><a href="#cb23-235" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Power vs. Sample Size for Block vs. Complete Randomization"</span>,</span>
<span id="cb23-236"><a href="#cb23-236" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Sample Size (N)"</span>),</span>
<span id="cb23-237"><a href="#cb23-237" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Estimated Power"</span>),</span>
<span id="cb23-238"><a href="#cb23-238" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Design"</span>))</span>
<span id="cb23-239"><a href="#cb23-239" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-240"><a href="#cb23-240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-241"><a href="#cb23-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-242"><a href="#cb23-242" aria-hidden="true" tabindex="-1"></a>This simulation demonstrates how **block randomization consistently outperforms complete randomization**, especially when statistical power hovers around the 60–90% range—precisely where most experiments aim to land.</span>
<span id="cb23-243"><a href="#cb23-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-244"><a href="#cb23-244" aria-hidden="true" tabindex="-1"></a>In our simulation, **80% power** is reached at:</span>
<span id="cb23-245"><a href="#cb23-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-246"><a href="#cb23-246" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Block randomization: <span class="in">`r results |&gt; filter(design == "Block", power &gt;= 0.8) |&gt; pull(N) |&gt; min()`</span></span>
<span id="cb23-247"><a href="#cb23-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-248"><a href="#cb23-248" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Complete randomization: <span class="in">`r results |&gt; filter(design == "Complete", power &gt;= 0.8) |&gt; pull(N) |&gt; min()`</span></span>
<span id="cb23-249"><a href="#cb23-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-250"><a href="#cb23-250" aria-hidden="true" tabindex="-1"></a>This shows that block randomization can achieve desired power levels **with fewer units**—a real advantage when resources are limited or units are hard to recruit.</span>
<span id="cb23-251"><a href="#cb23-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-252"><a href="#cb23-252" aria-hidden="true" tabindex="-1"></a>This can even be further increased if we would have controlled for the variable <span class="in">`west`</span> in the linear regression we used here to test whether the effect is significant or not.</span>
<span id="cb23-253"><a href="#cb23-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-254"><a href="#cb23-254" aria-hidden="true" tabindex="-1"></a><span class="fu">## Factorial Designs</span></span>
<span id="cb23-255"><a href="#cb23-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-256"><a href="#cb23-256" aria-hidden="true" tabindex="-1"></a>A **factorial design** is an experimental setup in which **two or more factors are varied simultaneously**, allowing researchers to study not only the **individual effects** of each factor (main effects), but also their **interactions**. The most basic version is a **2×2 factorial design**, where each of two factors has two levels. This results in **four unique combinations** (2 × 2 = 4).</span>
<span id="cb23-257"><a href="#cb23-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-258"><a href="#cb23-258" aria-hidden="true" tabindex="-1"></a>Factorial designs are especially useful when:</span>
<span id="cb23-259"><a href="#cb23-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-260"><a href="#cb23-260" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>You want to test multiple interventions at once,</span>
<span id="cb23-261"><a href="#cb23-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-262"><a href="#cb23-262" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>You are interested in **interaction effects** (e.g., whether A is only effective when B is also present),</span>
<span id="cb23-263"><a href="#cb23-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-264"><a href="#cb23-264" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>You want to maximize efficiency by getting multiple tests out of a single experiment.</span>
<span id="cb23-265"><a href="#cb23-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-266"><a href="#cb23-266" aria-hidden="true" tabindex="-1"></a>Suppose you're testing how political messages influence public opinion. You vary on the one hand the political orientation of the message: *left-leaning* vs. *right-leaning*, and the strength of the message: *soft* vs. *strong* rhetoric:</span>
<span id="cb23-267"><a href="#cb23-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-270"><a href="#cb23-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-271"><a href="#cb23-271" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb23-272"><a href="#cb23-272" aria-hidden="true" tabindex="-1"></a>    <span class="at">msg_strength =</span> <span class="fu">complete_ra</span>(<span class="dv">100</span>, <span class="dv">40</span>, <span class="at">conditions =</span> <span class="fu">c</span>(<span class="st">"weak"</span>, <span class="st">"strong"</span>) ), <span class="co"># 60:40</span></span>
<span id="cb23-273"><a href="#cb23-273" aria-hidden="true" tabindex="-1"></a>    <span class="at">msg_orientation =</span> <span class="fu">block_ra</span>(msg_strength, <span class="at">conditions =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"right"</span>))  <span class="co"># 50:50</span></span>
<span id="cb23-274"><a href="#cb23-274" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-275"><a href="#cb23-275" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(df, <span class="fu">table</span>(msg_strength, msg_orientation))</span>
<span id="cb23-276"><a href="#cb23-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-277"><a href="#cb23-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-278"><a href="#cb23-278" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb23-279"><a href="#cb23-279" aria-hidden="true" tabindex="-1"></a><span class="fu">### Full vs. Fractional Factorial Designs</span></span>
<span id="cb23-280"><a href="#cb23-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-281"><a href="#cb23-281" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A **full factorial design** includes **all possible combinations** of the factors.</span>
<span id="cb23-282"><a href="#cb23-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-283"><a href="#cb23-283" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A (**fractional**) **factorial design** includes **only a subset** of combinations, often used when the total number of combinations is too large to be practical (e.g., in conjoint experiments or vignette studies).</span>
<span id="cb23-284"><a href="#cb23-284" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb23-285"><a href="#cb23-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-286"><a href="#cb23-286" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cluster Randomization</span></span>
<span id="cb23-287"><a href="#cb23-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-288"><a href="#cb23-288" aria-hidden="true" tabindex="-1"></a>In many applied contexts, **randomization must occur at the group or “cluster” level**—for example, assigning entire schools, villages, or social networks to a treatment condition rather than individual units. This often isn’t the ideal from a statistical perspective. Ideally, we would randomize **individuals**, because this generally yields the **highest statistical power**. But in practice, that’s often not possible.</span>
<span id="cb23-289"><a href="#cb23-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-290"><a href="#cb23-290" aria-hidden="true" tabindex="-1"></a>Let’s consider education as an example. Suppose we want to measure **learning outcomes** in elementary school. While the outcome—test performance—is measured at the individual level (the student), the **treatment** might inherently apply to the entire group:</span>
<span id="cb23-291"><a href="#cb23-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-292"><a href="#cb23-292" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If a class gets an additional lesson per week, it affect the **entire class**.</span>
<span id="cb23-293"><a href="#cb23-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-294"><a href="#cb23-294" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If you give a teacher training, it spills over into **every class** the teacher teaches.</span>
<span id="cb23-295"><a href="#cb23-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-296"><a href="#cb23-296" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If an educational policy is implemented at the **school** or **district** level, it applies to all students within those units.</span>
<span id="cb23-297"><a href="#cb23-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-298"><a href="#cb23-298" aria-hidden="true" tabindex="-1"></a>In such cases, individual-level randomization would not be feasible or meaningful. Instead, we randomize entire **clusters**—like classes, schools, or even regions.</span>
<span id="cb23-299"><a href="#cb23-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-300"><a href="#cb23-300" aria-hidden="true" tabindex="-1"></a>To understand how different randomization strategies affect assignment—and ultimately power—let’s simulate a school system. We assume:</span>
<span id="cb23-301"><a href="#cb23-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-302"><a href="#cb23-302" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>4 schools</span>
<span id="cb23-303"><a href="#cb23-303" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Each school has 4 classes</span>
<span id="cb23-304"><a href="#cb23-304" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Each class has 4 students</span>
<span id="cb23-305"><a href="#cb23-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-308"><a href="#cb23-308" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-309"><a href="#cb23-309" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb23-310"><a href="#cb23-310" aria-hidden="true" tabindex="-1"></a>  <span class="at">school  =</span> <span class="fu">factor</span>(<span class="fu">paste0</span>(<span class="st">"School "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)), <span class="co"># four schools</span></span>
<span id="cb23-311"><a href="#cb23-311" aria-hidden="true" tabindex="-1"></a>  <span class="at">class   =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,                            <span class="co"># in each school four classes</span></span>
<span id="cb23-312"><a href="#cb23-312" aria-hidden="true" tabindex="-1"></a>  <span class="at">student =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>                             <span class="co"># in each class four students</span></span>
<span id="cb23-313"><a href="#cb23-313" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb23-314"><a href="#cb23-314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-315"><a href="#cb23-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-316"><a href="#cb23-316" aria-hidden="true" tabindex="-1"></a>Let’s assume that:</span>
<span id="cb23-317"><a href="#cb23-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-318"><a href="#cb23-318" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Test scores follow a normal distribution (mean = 50, SD = 10),</span>
<span id="cb23-319"><a href="#cb23-319" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>School 1 is 5 points better than the rest,</span>
<span id="cb23-320"><a href="#cb23-320" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A treatment effect of +10 points is applied (Cohen’s d ≈ 1).</span>
<span id="cb23-321"><a href="#cb23-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-322"><a href="#cb23-322" aria-hidden="true" tabindex="-1"></a>We now apply several different randomization designs:</span>
<span id="cb23-323"><a href="#cb23-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-326"><a href="#cb23-326" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-327"><a href="#cb23-327" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1337</span>)</span>
<span id="cb23-328"><a href="#cb23-328" aria-hidden="true" tabindex="-1"></a>effect_treatment <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb23-329"><a href="#cb23-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-330"><a href="#cb23-330" aria-hidden="true" tabindex="-1"></a>df_all <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb23-331"><a href="#cb23-331" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span> <span class="co"># 1) Simple</span></span>
<span id="cb23-332"><a href="#cb23-332" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb23-333"><a href="#cb23-333" aria-hidden="true" tabindex="-1"></a>        <span class="at">design    =</span> <span class="st">"Simple"</span>,</span>
<span id="cb23-334"><a href="#cb23-334" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="fu">simple_ra</span>(<span class="at">N =</span> <span class="fu">n</span>())   </span>
<span id="cb23-335"><a href="#cb23-335" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb23-336"><a href="#cb23-336" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span> <span class="co"># 2) Complete</span></span>
<span id="cb23-337"><a href="#cb23-337" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb23-338"><a href="#cb23-338" aria-hidden="true" tabindex="-1"></a>        <span class="at">design    =</span> <span class="st">"Complete"</span>,</span>
<span id="cb23-339"><a href="#cb23-339" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="fu">complete_ra</span>(<span class="at">N =</span> <span class="fu">n</span>())   </span>
<span id="cb23-340"><a href="#cb23-340" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb23-341"><a href="#cb23-341" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span> <span class="co"># 3) Block - School</span></span>
<span id="cb23-342"><a href="#cb23-342" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb23-343"><a href="#cb23-343" aria-hidden="true" tabindex="-1"></a>        <span class="at">design    =</span> <span class="st">"Block (School)"</span>,</span>
<span id="cb23-344"><a href="#cb23-344" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="fu">block_ra</span>(school)  </span>
<span id="cb23-345"><a href="#cb23-345" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb23-346"><a href="#cb23-346" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span> <span class="co"># 4) Cluster - School</span></span>
<span id="cb23-347"><a href="#cb23-347" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb23-348"><a href="#cb23-348" aria-hidden="true" tabindex="-1"></a>        <span class="at">design    =</span> <span class="st">"Cluster (School)"</span>,</span>
<span id="cb23-349"><a href="#cb23-349" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="fu">cluster_ra</span>(school)  </span>
<span id="cb23-350"><a href="#cb23-350" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb23-351"><a href="#cb23-351" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span> <span class="co"># 5) Cluster - Class &amp; School</span></span>
<span id="cb23-352"><a href="#cb23-352" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb23-353"><a href="#cb23-353" aria-hidden="true" tabindex="-1"></a>        <span class="at">design    =</span> <span class="st">"Cluster (School &amp; Class)"</span>,</span>
<span id="cb23-354"><a href="#cb23-354" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment =</span> <span class="fu">cluster_ra</span>(<span class="fu">interaction</span>(school, class, <span class="at">drop =</span> <span class="cn">TRUE</span>)) <span class="co"># compute factor interactions</span></span>
<span id="cb23-355"><a href="#cb23-355" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb23-356"><a href="#cb23-356" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span> <span class="co"># 6) Cluster &amp; Block - Grade &amp; School</span></span>
<span id="cb23-357"><a href="#cb23-357" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb23-358"><a href="#cb23-358" aria-hidden="true" tabindex="-1"></a>        <span class="at">design     =</span> <span class="st">"Block (S.) &amp; Cluster (S.&amp;C.)"</span>,</span>
<span id="cb23-359"><a href="#cb23-359" aria-hidden="true" tabindex="-1"></a>        <span class="at">treatment  =</span> <span class="fu">block_and_cluster_ra</span>(</span>
<span id="cb23-360"><a href="#cb23-360" aria-hidden="true" tabindex="-1"></a>          <span class="at">clusters =</span> <span class="fu">interaction</span>(school, class, <span class="at">drop =</span> <span class="cn">TRUE</span>),</span>
<span id="cb23-361"><a href="#cb23-361" aria-hidden="true" tabindex="-1"></a>          <span class="at">blocks   =</span> school</span>
<span id="cb23-362"><a href="#cb23-362" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb23-363"><a href="#cb23-363" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb23-364"><a href="#cb23-364" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb23-365"><a href="#cb23-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-366"><a href="#cb23-366" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>) <span class="sc">+</span>     <span class="co"># random noise (sd=10)</span></span>
<span id="cb23-367"><a href="#cb23-367" aria-hidden="true" tabindex="-1"></a>              effect_treatment <span class="sc">*</span> treatment <span class="sc">+</span>       <span class="co"># treatment effect</span></span>
<span id="cb23-368"><a href="#cb23-368" aria-hidden="true" tabindex="-1"></a>              <span class="fu">if_else</span>(school <span class="sc">==</span> <span class="st">"School 1"</span>, <span class="dv">5</span>, <span class="dv">0</span>)  <span class="co"># school one 1 is 5 points better </span></span>
<span id="cb23-369"><a href="#cb23-369" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-370"><a href="#cb23-370" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-371"><a href="#cb23-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-372"><a href="#cb23-372" aria-hidden="true" tabindex="-1"></a>@fig-random-designs shows how treatment is distributed under each design:</span>
<span id="cb23-373"><a href="#cb23-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-374"><a href="#cb23-374" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Simple** (top-left) more students are treated than not.</span>
<span id="cb23-375"><a href="#cb23-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-376"><a href="#cb23-376" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Complete** (top-middle) ensures overall balance but can result in imbalanced clusters (e.g. school 1 &amp; 3).</span>
<span id="cb23-377"><a href="#cb23-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-378"><a href="#cb23-378" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Block (School)** (top-right) balances treatment assignments **within each school**, improving comparability.</span>
<span id="cb23-379"><a href="#cb23-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-380"><a href="#cb23-380" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Cluster (School)** (bottom-left) assigns **entire schools** to treatment or control.</span>
<span id="cb23-381"><a href="#cb23-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-382"><a href="#cb23-382" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Cluster (School &amp; Class)** (bottom-middle) strikes a balance: it assigns whole class-level units to treatment while still keeping some diversity within schools. Yet is is not assured that treated classes in a given school are balanced (e.g. School 2 &amp; 4).</span>
<span id="cb23-383"><a href="#cb23-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-384"><a href="#cb23-384" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Block (School) &amp; Cluster (School &amp; Class)** (bottom-right) similar to cluster randomization over school and class but with a balanced set of classes per school.</span>
<span id="cb23-385"><a href="#cb23-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-388"><a href="#cb23-388" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-389"><a href="#cb23-389" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-random-designs</span></span>
<span id="cb23-390"><a href="#cb23-390" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Patterns of different random assignment designs. Each row represents a different class, and each cell a different student. Colors indicate treatment assignment (Blue = Control, Red = Treatment). </span></span>
<span id="cb23-391"><a href="#cb23-391" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb23-392"><a href="#cb23-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-393"><a href="#cb23-393" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb23-394"><a href="#cb23-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-395"><a href="#cb23-395" aria-hidden="true" tabindex="-1"></a><span class="co"># make one plot per design</span></span>
<span id="cb23-396"><a href="#cb23-396" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> df_all <span class="sc">%&gt;%</span></span>
<span id="cb23-397"><a href="#cb23-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(.<span class="sc">$</span>design) <span class="sc">%&gt;%</span>  </span>
<span id="cb23-398"><a href="#cb23-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="cf">function</span>(dd){</span>
<span id="cb23-399"><a href="#cb23-399" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(dd, </span>
<span id="cb23-400"><a href="#cb23-400" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> student, <span class="at">y =</span> class, <span class="at">fill =</span> <span class="fu">factor</span>(treatment))) <span class="sc">+</span></span>
<span id="cb23-401"><a href="#cb23-401" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>(<span class="at">colour =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb23-402"><a href="#cb23-402" aria-hidden="true" tabindex="-1"></a>      <span class="co"># map 0 → teal, 1 → red</span></span>
<span id="cb23-403"><a href="#cb23-403" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"#357ABD"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"#F56565"</span>)) <span class="sc">+</span></span>
<span id="cb23-404"><a href="#cb23-404" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span> school, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb23-405"><a href="#cb23-405" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-406"><a href="#cb23-406" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>( <span class="at">title =</span> dd<span class="sc">$</span>design) <span class="sc">+</span></span>
<span id="cb23-407"><a href="#cb23-407" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb23-408"><a href="#cb23-408" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title       =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-409"><a href="#cb23-409" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text        =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-410"><a href="#cb23-410" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks       =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-411"><a href="#cb23-411" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid       =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-412"><a href="#cb23-412" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey80"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb23-413"><a href="#cb23-413" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text       =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb23-414"><a href="#cb23-414" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title       =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb23-415"><a href="#cb23-415" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.spacing    =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"lines"</span>),</span>
<span id="cb23-416"><a href="#cb23-416" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position   =</span> <span class="st">"none"</span>,    <span class="co"># remove legend</span></span>
<span id="cb23-417"><a href="#cb23-417" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb23-418"><a href="#cb23-418" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb23-419"><a href="#cb23-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-420"><a href="#cb23-420" aria-hidden="true" tabindex="-1"></a><span class="co"># assemble into a 2x2 grid</span></span>
<span id="cb23-421"><a href="#cb23-421" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> (plots[[<span class="dv">6</span>]] <span class="sc">|</span> plots[[<span class="dv">5</span>]] <span class="sc">|</span> plots[[<span class="dv">2</span>]]) <span class="sc">/</span></span>
<span id="cb23-422"><a href="#cb23-422" aria-hidden="true" tabindex="-1"></a>            (plots[[<span class="dv">4</span>]] <span class="sc">|</span> plots[[<span class="dv">3</span>]] <span class="sc">|</span> plots[[<span class="dv">1</span>]])</span>
<span id="cb23-423"><a href="#cb23-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-424"><a href="#cb23-424" aria-hidden="true" tabindex="-1"></a>combined</span>
<span id="cb23-425"><a href="#cb23-425" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-426"><a href="#cb23-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-427"><a href="#cb23-427" aria-hidden="true" tabindex="-1"></a>Although clustering may be necessary, it comes at a **cost to statistical power**. Why? Because observations within clusters are **not independent**. If a teacher affects all their students, then those students’ outcomes are correlated—not independent replicates.</span>
<span id="cb23-428"><a href="#cb23-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-429"><a href="#cb23-429" aria-hidden="true" tabindex="-1"></a>Let’s see the consequences of this. Suppose we analyze the "Cluster (School)" design with a standard t-test:</span>
<span id="cb23-430"><a href="#cb23-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-433"><a href="#cb23-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-434"><a href="#cb23-434" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(outcome <span class="sc">~</span> treatment, <span class="at">data =</span> df_all <span class="sc">|&gt;</span> <span class="fu">filter</span>(design <span class="sc">==</span> <span class="st">"Cluster (School)"</span>))</span>
<span id="cb23-435"><a href="#cb23-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-436"><a href="#cb23-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-437"><a href="#cb23-437" aria-hidden="true" tabindex="-1"></a>We get a highly significant result ($p &lt; 0.001$)—but this is misleading. The test treats all 64 students as independent, which violates assumptions.</span>
<span id="cb23-438"><a href="#cb23-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-439"><a href="#cb23-439" aria-hidden="true" tabindex="-1"></a><span class="fu">### Two Ways to Account for Clustering</span></span>
<span id="cb23-440"><a href="#cb23-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-441"><a href="#cb23-441" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Aggregating to the Cluster Level**</span>
<span id="cb23-442"><a href="#cb23-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-443"><a href="#cb23-443" aria-hidden="true" tabindex="-1"></a>Instead of treating each student as a separate unit, we summarize outcomes at the school level:</span>
<span id="cb23-444"><a href="#cb23-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-447"><a href="#cb23-447" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-448"><a href="#cb23-448" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(outcome <span class="sc">~</span> treatment, </span>
<span id="cb23-449"><a href="#cb23-449" aria-hidden="true" tabindex="-1"></a>       <span class="at">data =</span> df_all <span class="sc">|&gt;</span> </span>
<span id="cb23-450"><a href="#cb23-450" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(design <span class="sc">==</span> <span class="st">"Cluster (School)"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-451"><a href="#cb23-451" aria-hidden="true" tabindex="-1"></a>         <span class="fu">group_by</span>(school, treatment)  <span class="sc">|&gt;</span>           <span class="co"># while it is useless to group by "treatment", it keeps the variable</span></span>
<span id="cb23-452"><a href="#cb23-452" aria-hidden="true" tabindex="-1"></a>         <span class="fu">summarize</span>(<span class="at">outcome =</span> <span class="fu">mean</span>(outcome), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb23-453"><a href="#cb23-453" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb23-454"><a href="#cb23-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-455"><a href="#cb23-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-456"><a href="#cb23-456" aria-hidden="true" tabindex="-1"></a>Now, the test is no longer significant (p = 0.151). We reduced pseudo-replication by correctly using the cluster as the unit of analysis. But we also lost power because we only have 4 clusters (schools).</span>
<span id="cb23-457"><a href="#cb23-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-458"><a href="#cb23-458" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Using Hierarchical Models (e.g., Mixed Effects)**</span>
<span id="cb23-459"><a href="#cb23-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-460"><a href="#cb23-460" aria-hidden="true" tabindex="-1"></a>An alternative is to use a random effects or multilevel model that accounts for the hierarchical structure:</span>
<span id="cb23-461"><a href="#cb23-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-464"><a href="#cb23-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-465"><a href="#cb23-465" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb23-466"><a href="#cb23-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-467"><a href="#cb23-467" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lmer</span>(outcome <span class="sc">~</span> treatment <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> school), <span class="at">data =</span> df_all <span class="sc">|&gt;</span> <span class="fu">filter</span>(design <span class="sc">==</span> <span class="st">"Cluster (School)"</span>))</span>
<span id="cb23-468"><a href="#cb23-468" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb23-469"><a href="#cb23-469" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-470"><a href="#cb23-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-471"><a href="#cb23-471" aria-hidden="true" tabindex="-1"></a>This approach retains individual-level data, while correctly modeling the correlation within clusters.</span>
<span id="cb23-472"><a href="#cb23-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-473"><a href="#cb23-473" aria-hidden="true" tabindex="-1"></a>Another problem is that if the clusters differ **systematically** in ways that affect the outcome—say, wealthier schools tend to be assigned more likely to the treatment—we risk **bias** or inflated variance unless properly controlled for. If you look at @fig-random-designs the cluster assignment for schools would not allow us to differentiate between treatment effect and effects of school 1 &amp; 3.</span>
<span id="cb23-474"><a href="#cb23-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-475"><a href="#cb23-475" aria-hidden="true" tabindex="-1"></a><span class="fu">### Spillover Designs</span></span>
<span id="cb23-476"><a href="#cb23-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-477"><a href="#cb23-477" aria-hidden="true" tabindex="-1"></a>While we talked about clustering and how it is sometimes not avoidable, sometimes it is and we want to do it anyways! This is the case when we assume sp called **spillover effects**. **Spillovers** (also called **interference** or **externalities**) occur when the treatment assigned to one unit influences the **outcomes of other units**. This violates a common assumption in experimental design called the **Stable Unit Treatment Value Assumption (SUTVA)**, which states that a unit’s potential outcomes depend only on its own treatment status—not on the treatment status of others.</span>
<span id="cb23-478"><a href="#cb23-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-479"><a href="#cb23-479" aria-hidden="true" tabindex="-1"></a>Spillovers can arise in many contexts:</span>
<span id="cb23-480"><a href="#cb23-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-481"><a href="#cb23-481" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Education**: A student receiving extra tutoring may affect classmates through peer learning.</span>
<span id="cb23-482"><a href="#cb23-482" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Public health**: Vaccinating some individuals may reduce transmission risk for unvaccinated individuals.</span>
<span id="cb23-483"><a href="#cb23-483" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Politics**: Exposing one person to a political campaign can influence friends or family they talk to.</span>
<span id="cb23-484"><a href="#cb23-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-485"><a href="#cb23-485" aria-hidden="true" tabindex="-1"></a>But they’re not always bad! Sometimes **estimating spillovers is the goal**, and designs can be tailored to **identify both direct and indirect effects**.</span>
<span id="cb23-486"><a href="#cb23-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-487"><a href="#cb23-487" aria-hidden="true" tabindex="-1"></a>If you suspect spillovers might exist, don’t ignore them—design around them with a two-stage randomization (or double randomization)<span class="sc">\*\*</span></span>
<span id="cb23-488"><a href="#cb23-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-489"><a href="#cb23-489" aria-hidden="true" tabindex="-1"></a>Randomly assign:</span>
<span id="cb23-490"><a href="#cb23-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-491"><a href="#cb23-491" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Some clusters to complete treatment,</span>
<span id="cb23-492"><a href="#cb23-492" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Some clusters to complete control,</span>
<span id="cb23-493"><a href="#cb23-493" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>And some clusters to mixed control and treatment.</span>
<span id="cb23-494"><a href="#cb23-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-495"><a href="#cb23-495" aria-hidden="true" tabindex="-1"></a>This allows you to estimate:</span>
<span id="cb23-496"><a href="#cb23-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-497"><a href="#cb23-497" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Direct effects** (treated vs untreated within treated clusters),</span>
<span id="cb23-498"><a href="#cb23-498" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Spillover effects** (untreated in treated clusters vs untreated in control clusters),</span>
<span id="cb23-499"><a href="#cb23-499" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Total effects** (treated in treated clusters vs untreated in control clusters).</span>
<span id="cb23-500"><a href="#cb23-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-501"><a href="#cb23-501" aria-hidden="true" tabindex="-1"></a><span class="fu"># Ethics of Randomization</span></span>
<span id="cb23-502"><a href="#cb23-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-503"><a href="#cb23-503" aria-hidden="true" tabindex="-1"></a>**Randomization** is a foundational tool for identifying causal effects in experimental research. From a design perspective, it helps ensure that treatment assignment is not biased by unobserved factors. However, **randomization also raises important ethical questions**, particularly when it involves real-world interventions that affect people's lives.</span>
<span id="cb23-504"><a href="#cb23-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-505"><a href="#cb23-505" aria-hidden="true" tabindex="-1"></a><span class="fu">### When Is Randomization Ethical?</span></span>
<span id="cb23-506"><a href="#cb23-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-507"><a href="#cb23-507" aria-hidden="true" tabindex="-1"></a>In the **long term**, randomization can be an ethical way to allocate limited resources. By rigorously testing which programs or policies are most effective, researchers help ensure that future investments deliver maximum benefit. Randomization also avoids allocation based on arbitrary or potentially biased criteria.</span>
<span id="cb23-508"><a href="#cb23-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-509"><a href="#cb23-509" aria-hidden="true" tabindex="-1"></a>In the **short term**, randomization may be seen as a fair method when demand for a program exceeds supply. Instead of selecting beneficiaries based on subjective judgments, random assignment can distribute access in a transparent and impartial way.</span>
<span id="cb23-510"><a href="#cb23-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-511"><a href="#cb23-511" aria-hidden="true" tabindex="-1"></a><span class="fu">### When Is Randomization Problematic?</span></span>
<span id="cb23-512"><a href="#cb23-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-513"><a href="#cb23-513" aria-hidden="true" tabindex="-1"></a>However, randomization is not always ethically neutral. Consider a program that provides loans. If we randomly assign loans to both low-income and high-income individuals, we may end up **diverting resources away from those who need them most**. If the treatment is already believed to be beneficial, denying it to vulnerable populations for the sake of experimentation can be ethically troubling.</span>
<span id="cb23-514"><a href="#cb23-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-515"><a href="#cb23-515" aria-hidden="true" tabindex="-1"></a>In such cases, **researchers must weigh the social value of the experiment against the potential harm**. Where possible, designs should be structured to **ultimately benefit all participants**, including those initially assigned to control.</span>
<span id="cb23-516"><a href="#cb23-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-517"><a href="#cb23-517" aria-hidden="true" tabindex="-1"></a><span class="fu"># 🧩 Conclusion</span></span>
<span id="cb23-518"><a href="#cb23-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-519"><a href="#cb23-519" aria-hidden="true" tabindex="-1"></a>Randomization is not just a technical procedure—it’s the backbone of credible causal inference. In this chapter, we explored a variety of randomization techniques, from simple and complete randomization to more advanced methods like block and cluster randomization, factorial designs, and waitlist approaches. Each method has its trade-offs, and understanding when and how to use them is crucial for designing effective experiments.</span>
<span id="cb23-520"><a href="#cb23-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-521"><a href="#cb23-521" aria-hidden="true" tabindex="-1"></a>We saw that **simple randomization**, while easy to implement, can lead to imbalance—especially in smaller samples—reducing power. **Block randomization** improves balance on known covariates and can significantly increase statistical power without increasing sample size. **Cluster randomization**, though sometimes necessary, comes with a cost to power due to reduced unit independence. **Factorial designs** allow us to test multiple treatments efficiently, while **spillover-aware designs** help us understand broader causal dynamics in interconnected settings.</span>
<span id="cb23-522"><a href="#cb23-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-523"><a href="#cb23-523" aria-hidden="true" tabindex="-1"></a>Importantly, we also discussed the **ethical dimensions** of random assignment. While randomization is often the fairest way to allocate scarce resources, it must be used responsibly and transparently.</span>
<span id="cb23-524"><a href="#cb23-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-525"><a href="#cb23-525" aria-hidden="true" tabindex="-1"></a>Ultimately, good experimental design balances **rigor, feasibility, and ethics**. As researchers, our goal is not only to identify what works, but to do so in a way that is scientifically valid, practically useful, and ethically sound.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":true,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>